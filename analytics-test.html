<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Testing - Valhalla Tattoo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #d4af37;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .test-button:hover {
            background: #b8941f;
        }
        .test-results {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            margin: 5px 0;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>🧪 Analytics Testing Dashboard</h1>
    <p>This page helps test and debug the Google Analytics 4 implementation for Valhalla Tattoo.</p>

    <div class="test-section">
        <h2>📊 Analytics Status</h2>
        <div id="analytics-status" class="status info">Loading analytics status...</div>
        <button class="test-button" onclick="checkAnalyticsStatus()">Check Status</button>
        <button class="test-button" onclick="toggleConsent()">Toggle Consent</button>
    </div>

    <div class="test-section">
        <h2>🧪 Test Suite</h2>
        <p>Run comprehensive tests to verify analytics functionality:</p>
        <button class="test-button" onclick="runAllTests()">Run All Tests</button>
        <button class="test-button" onclick="startEventMonitoring()">Monitor Events</button>
        <div id="test-results" class="test-results" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>📡 Manual Event Testing</h2>
        <p>Test specific events manually:</p>
        <button class="test-button" onclick="testPageView()">Test Page View</button>
        <button class="test-button" onclick="testFormSubmission()">Test Form Submit</button>
        <button class="test-button" onclick="testPortfolioClick()">Test Portfolio Click</button>
        <button class="test-button" onclick="testSocialClick()">Test Social Click</button>
        <button class="test-button" onclick="testNewsletterSignup()">Test Newsletter Signup</button>
        <button class="test-button" onclick="testScrollDepth()">Test Scroll Depth</button>
    </div>

    <div class="test-section">
        <h2>🔍 Real-time Debugging</h2>
        <p>Monitor events in real-time (check browser console and GA4 real-time reports):</p>
        <button class="test-button" onclick="enableDebugMode()">Enable Debug Mode</button>
        <button class="test-button" onclick="disableDebugMode()">Disable Debug Mode</button>
        <div id="debug-output" class="test-results" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>📋 Testing Checklist</h2>
        <ul>
            <li>✅ Analytics initialization</li>
            <li>✅ Consent banner functionality</li>
            <li>✅ Event tracking</li>
            <li>✅ Form submission tracking</li>
            <li>✅ Portfolio interaction tracking</li>
            <li>✅ Social media click tracking</li>
            <li>✅ Performance metrics tracking</li>
            <li>✅ Privacy compliance</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>📖 Instructions</h2>
        <ol>
            <li><strong>Setup:</strong> Ensure Google Analytics 4 is configured with the correct Measurement ID</li>
            <li><strong>Consent:</strong> Grant consent when the banner appears (required for tracking)</li>
            <li><strong>Test:</strong> Click "Run All Tests" to verify all functionality</li>
            <li><strong>Monitor:</strong> Check Google Analytics Real-time reports to see events</li>
            <li><strong>Debug:</strong> Use browser console to see detailed event information</li>
        </ol>
    </div>

    <!-- Load the main application -->
    <script type="module" src="js/main.js"></script>

    <script>
        let analytics = null;
        let testSuite = null;

        // Wait for the app to initialize
        document.addEventListener('valhalla:initialized', (event) => {
            const app = event.detail.app;
            analytics = app.getAnalytics();
            testSuite = window.analyticsTestSuite;
            
            updateAnalyticsStatus();
            console.log('Analytics testing dashboard ready!');
        });

        function updateAnalyticsStatus() {
            const statusDiv = document.getElementById('analytics-status');
            
            if (!analytics) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '❌ Analytics not initialized';
                return;
            }

            const isReady = analytics.isReady();
            const consentStatus = analytics.getConsentStatus();
            
            if (isReady) {
                statusDiv.className = 'status success';
                statusDiv.textContent = `✅ Analytics ready | Consent: ${consentStatus ? 'Granted' : 'Denied'}`;
            } else {
                statusDiv.className = 'status info';
                statusDiv.textContent = `⏳ Analytics initialized | Consent: ${consentStatus ? 'Granted' : 'Denied'}`;
            }
        }

        function checkAnalyticsStatus() {
            updateAnalyticsStatus();
        }

        function toggleConsent() {
            if (!analytics) return;
            
            const currentConsent = analytics.getConsentStatus();
            analytics.updateConsent(!currentConsent);
            
            setTimeout(updateAnalyticsStatus, 100);
        }

        async function runAllTests() {
            if (!testSuite) {
                alert('Test suite not available. Make sure debug mode is enabled.');
                return;
            }

            const resultsDiv = document.getElementById('test-results');
            resultsDiv.style.display = 'block';
            resultsDiv.textContent = 'Running tests...';

            try {
                const results = await testSuite.runAllTests();
                resultsDiv.textContent = `Test Results: ${results.passed}/${results.total} passed\n\n` +
                    results.results.map(r => `${r.passed ? '✅' : '❌'} ${r.test}`).join('\n');
            } catch (error) {
                resultsDiv.textContent = `Error running tests: ${error.message}`;
            }
        }

        function startEventMonitoring() {
            if (!testSuite) return;
            
            testSuite.startEventMonitoring();
            alert('Event monitoring started. Check browser console for event logs.');
        }

        function testPageView() {
            if (!analytics) return;
            analytics.trackPageView({
                page_title: 'Test Page View',
                page_path: '/analytics-test'
            });
            console.log('📡 Test page view sent');
        }

        function testFormSubmission() {
            if (!analytics) return;
            analytics.trackFormSubmission('test_contact_form', {
                artist: 'jimmy',
                destination: 'test'
            });
            console.log('📡 Test form submission sent');
        }

        function testPortfolioClick() {
            if (!analytics) return;
            analytics.trackPortfolioInteraction('click', {
                artist_name: 'jimmy',
                image_id: 'test_image',
                portfolio_section: 'main'
            });
            console.log('📡 Test portfolio click sent');
        }

        function testSocialClick() {
            if (!analytics) return;
            analytics.trackSocialClick('instagram', 'test_page');
            console.log('📡 Test social click sent');
        }

        function testNewsletterSignup() {
            if (!analytics) return;
            analytics.trackNewsletterSignup({
                source: 'test_page',
                location: 'test_section'
            });
            console.log('📡 Test newsletter signup sent');
        }

        function testScrollDepth() {
            if (!analytics) return;
            analytics.trackScrollDepth(75);
            console.log('📡 Test scroll depth sent');
        }

        function enableDebugMode() {
            if (!analytics) return;
            analytics.enableDebugMode();
            console.log('🔍 Debug mode enabled');
        }

        function disableDebugMode() {
            if (!analytics) return;
            analytics.disableDebugMode();
            console.log('🔍 Debug mode disabled');
        }
    </script>
</body>
</html>